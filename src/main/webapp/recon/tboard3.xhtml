<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1 	QAZ	`999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui">

	<h:head>
		<h:outputStylesheet library="webjars" name="primeflex/2.0.0/primeflex.min.css" />
	</h:head>

	<h:body style="margin-left:50px">

		<style type="text/css">
			button.ui-button
			{
			margin-right: .5rem;
			}

			.dialog-style-class {
			width: 50%;
			height: 70%;
			}
		</style>

		<p:growl id="messages" />



		<h:form id="form">

			<div class="card">

				<p:toolbar rendered="true">
					<p:toolbarGroup>
						<p:commandLink style="margin-right:20px;" id="reset" value="Reset" icon="pi pi-search" action="#{taxView.reset}" disabled="false" update="taxtabs messages" />
						<p:commandLink style="margin-right:20px;" id="validate" value="Validate" icon="pi pi-search" action="#{taxView.validate}" disabled="true" update="taxtabs messages" />
						<p:commandLink style="margin-right:20px;" id="approve" value="Approve" icon="pi pi-search" action="#{taxView.approve}" disabled="false" update="taxtabs messages" />
						<p:commandLink style="margin-right:20px;" id="proceed" value="Proceed To next stage" icon="pi pi-search" ajax="false" action="#{taxView.proceed}" disabled="false" update="taxtabs messages"
							oncomplete="window.open('tboard3.xhtml')" />

						<p:commandLink style="margin-right:20px;" id="logout" value="Log out" action="#{father.logout}" oncomplete="window.open('home.xhtml','_self')" />

					</p:toolbarGroup>

					<p:toolbarGroup>
						<p:splitButton value="Reload" oncomplete="window.open('preview.xhtml')" icon="pi pi-save">
							<p:submenu label="Navigations">

								<p:menuitem value="Data Load" onclick="window.open('rdata.xhtml','_self')" ajax="true" />

								<p:menuitem value="Name Mapping" onclick="window.open('rnames.xhtml','_self')" ajax="true" />

								<p:menuitem value="Reonciliation" onclick="window.open('rboard6.xhtml','_self')" ajax="true" />

								<p:menuitem value="Preview" onclick="window.open('preview.xhtml','_self')" ajax="true" />

								<p:menuitem value="Tax computation" onclick="window.open('tboard3.xhtml','_self')" ajax="true" />

								<p:menuitem value="Generate" onclick="window.open('gview.xhtml','_self')" ajax="true" />

							</p:submenu>
						</p:splitButton>
					</p:toolbarGroup>
				</p:toolbar>




				<p:steps activeIndex="4">
					<p:menuitem value="Document Upload" />
					<p:menuitem value="Name mapping" />
					<p:menuitem value="Reconciliation" />
					<p:menuitem value="Review" />
					<p:menuitem value="Tax Positions" />
					<p:menuitem value="Generate" />

				</p:steps>

			</div>


			<div class="card">
				<p:growl id="messages" showDetail="true" />

				<p:toolbar rendered="false">
					<p:toolbarGroup>
						<p:commandButton value="New" icon="pi pi-plus" actionListener="#{taxView.openNew}" update=":form:manage-product-content" oncomplete="PF('manageProductDialog').show()"
							styleClass="ui-button-success" style="margin-right: .5rem">
							<p:resetInput target=":form:manage-product-content" />
						</p:commandButton>
						<p:commandButton id="delete-positions-button" value="#{taxView.deleteButtonMessage}" icon="pi pi-trash" actionListener="#{taxView.deleteSelectedProducts}"
							styleClass="ui-button-danger" disabled="#{!taxView.hasSelectedProducts()}" update="@this">
							<p:confirm header="Confirmation" message="Delete the selected positions?" icon="pi pi-exclamation-triangle" />
						</p:commandButton>
					</p:toolbarGroup>
					<p:toolbarGroup align="right">
						<p:fileUpload mode="simple" skinSimple="true" label="Import" chooseIcon="pi pi-download" />
						<p:commandButton value="Export" icon="pi pi-upload" styleClass="ui-button-help" ajax="false">
							<p:dataExporter type="pdf" target="dt-positions" fileName="positions" />
						</p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>


				<div class="card">
					<p:tabView id="taxtabs">

						<p:tab title="Tax computation">
						
						
						
							
						
							<p:dataTable id="dt-positions" widgetVar="dtProducts" var="product" value="#{taxView.positions}" 
											reflow="true" styleClass="positions-table" selection="#{taxView.selectedPositions}"
											rowKey="#{product.code}"  paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">


								<p:ajax event="rowSelect" update=":form:delete-positions-button" />
								<p:ajax event="rowUnselect" update=":form:delete-positions-button" />
								<p:ajax event="rowSelectCheckbox" update=":form:delete-positions-button" />
								<p:ajax event="rowUnselectCheckbox" update=":form:delete-positions-button" />
								<p:ajax event="toggleSelect" update=":form:delete-positions-button" />


								<p:column headerText="Nature" sortBy="#{product.name}">
									<h:outputText value="#{product.name}" />
								</p:column>
								<p:column headerText="Amount" sortBy="#{product.amount}">
									<h:outputText value="#{product.amount}" style="font-weight: 700">
										<f:convertNumber currencySymbol="Rs" type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="TDS" sortBy="#{product.tds}">
									<h:outputText value="#{product.tds}" style="font-weight: 700">
										<f:convertNumber currencySymbol="Rs" type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="Income(Y/N)" sortBy="#{product.nonIncome}">
									<h:outputText value="#{product.nonIncome}" style="font-weight: 700">
									</h:outputText>
								</p:column>

								<p:column headerText="Act">
									<h:outputText value="#{product.category}" />
								</p:column>
								<p:column headerText="Country">
									<h:outputText value="#{product.country}" />
								</p:column>
								<p:column headerText="Section">
									<h:outputText value="#{product.section}" />
								</p:column>

								<p:column headerText="Tax-rate">
									<h:outputText value="#{product.rating}" style="font-weight: 700">
									</h:outputText>
								</p:column>
								<p:column headerText="Tax-amount">
									<h:outputText value="#{product.taxAmount}" style="font-weight: 700">
										<f:convertNumber currencySymbol="Rs" type="currency" />
									</h:outputText>
								</p:column>
								<p:column headerText="Change">
									<h:outputText value="#{product.reason}" />
								</p:column>


								<p:column exportable="false">
									<p:commandButton icon="pi pi-pencil" update=":form:manage-product-content" oncomplete="PF('manageProductDialog').show()"
										styleClass="edit-button rounded-button ui-button-success" process="@this">
										<f:setPropertyActionListener value="#{product}" target="#{taxView.selectedPosition}" />
										<p:resetInput target=":form:manage-product-content" />
									</p:commandButton>
								</p:column>

							</p:dataTable>


						</p:tab>

						<p:tab title="DTAA">

							<p:dataTable id="dt-dtaa" widgetVar="dtDtaa" var="product" value="#{ref.dtaa}" styleClass="positions-table" paginator="true" rows="10" paginatorPosition="bottom">

								int countryCode ;
								String country ;
								String nature ;

								double taxRate1 ;
								double taxRate2 ;

								<p:column headerText="Country Code" sortBy="#{product.countryCode}">
									<h:outputText value="#{product.countryCode}" />
								</p:column>

								<p:column headerText="Country" sortBy="#{product.country}">
									<h:outputText value="#{product.country}" />
								</p:column>

								<p:column headerText="Nature" sortBy="#{product.nature}">
									<h:outputText value="#{product.nature}" />
								</p:column>

								<p:column headerText="Tax Rate 1" sortBy="#{product.taxRate1}">
									<h:outputText value="#{product.taxRate1}" />
								</p:column>


								<p:column headerText="Tax Rate 2" sortBy="#{product.taxRate2}">
									<h:outputText value="#{product.taxRate2}" />
								</p:column>

							</p:dataTable>

						</p:tab>

						<p:tab title="ITAA">

							<p:dataTable id="dt-itaa" widgetVar="dtItaa" var="product" value="#{ref.itaa}" styleClass="positions-table" paginator="true" rows="10" paginatorPosition="bottom">



								<p:column headerText="Sr No" sortBy="#{product.srNo}">
									<h:outputText value="#{product.srNo}" />
								</p:column>

								<p:column headerText="Nature" sortBy="#{product.nature}">
									<h:outputText value="#{product.nature}" />
								</p:column>

								<p:column headerText="Section" sortBy="#{product.section}">
									<h:outputText value="#{product.section}" />
								</p:column>

								<p:column headerText="Tax Rate" sortBy="#{product.taxRate}">
									<h:outputText value="#{product.taxRate}" />
								</p:column>

							</p:dataTable>


						</p:tab>

					</p:tabView>

				</div>




				<p:dialog header="Tax Details" showEffect="fade" modal="true" widgetVar="manageProductDialog" responsive="true">
					<p:outputPanel id="manage-product-content" class="ui-fluid">
						<p:outputPanel rendered="#{not empty taxView.selectedPosition}">
							<p:graphicImage name="images/product/#{taxView.selectedPosition.image}" library="demo" styleClass="product-image" rendered="#{not empty taxView.selectedPosition.image}" />

							<div class="p-field">
								<p:outputLabel for="name2">Nature</p:outputLabel>
								<p:selectOneMenu id="name2" value="#{taxView.selectedPosition.name}" layout="responsive" valueChangeListener="#{taxView.incomeSelected}" readonly="true">
									<f:selectItems value="#{ref.defNatures}" var="nature" itemLabel="#{nature}" itemValue="#{nature}" />
									<p:ajax process="@this" update="manage-product-content" />
								</p:selectOneMenu>

							</div>


							<div class="p-formgrid p-grid">
								<div class="p-field p-col">
									<p:outputLabel for="price">Amount</p:outputLabel>
									<p:inputNumber id="price" value="#{taxView.selectedPosition.amount}" decimalSeparator="." thousandSeparator="," readonly="true" />
								</div>

								<div class="p-field p-col">
									<p:outputLabel for="quantity">Tds</p:outputLabel>
									<p:inputNumber id="quantity" value="#{taxView.selectedPosition.tds}" decimalSeparator="." thousandSeparator="," readonly="true" />
								</div>
							</div>


							<div class="p-field">
								<p:toggleSwitch id="incometoggle" value="#{taxView.selectedPosition.nonIncome}" valueChangeListener="#{taxView.incomeSelected}">
									<p:ajax process="@this" update="manage-product-content" />
								</p:toggleSwitch>

								<p:outputLabel for="incometoggle"> Income (Y/N) </p:outputLabel>
							</div>





							<p:outputPanel id="taxcomputationpanel" rendered="#{taxView.selectedPosition.nonIncome}">
								<p class="p-field">
									<div class="p-field">
										<p:outputLabel for="category">ACT</p:outputLabel>
										<p:selectOneRadio id="category" value="#{taxView.selectedPosition.category}" layout="responsive" columns="2" valueChangeListener="#{taxView.categorySelected}">
											<f:selectItem itemLabel="ITAA" itemValue="ITAA" />
											<f:selectItem itemLabel="DTAA" itemValue="DTAA" />
											<f:selectItem itemLabel="BOTH" itemValue="BOTH" />
											<f:selectItem itemLabel="NON-TAXABLE" itemValue="NON-TAXABLE" />
											<p:ajax process="@this" update="manage-product-content" />

										</p:selectOneRadio>
									</div>




									<div class="p-formgrid p-grid">

										<div class="p-field p-col">
											<p:outputLabel for="section" rendered="#{!taxView.selectedPosition.category.equals('DTAA')}">Section</p:outputLabel>
											<p:inputText id="section" value="#{taxView.selectedPosition.section}" rendered="#{!taxView.selectedPosition.category.equals('DTAA')}" />
										</div>

										<div class="p-field p-col">
											<p:outputLabel value="Country" for="country" rendered="#{taxView.countryEnabled}" />
											<p:autoComplete id="country" value="#{taxView.selectedPosition.country}" rendered="#{taxView.countryEnabled}" completeMethod="#{taxView.completeCountry}" scrollHeight="250"
												dropdown="true" valueChangeListener="#{taxView.countrySelected}">

												<p:ajax process="@this" update="manage-product-content" />

											</p:autoComplete>
										</div>
									</div>


									<div class="p-formgrid p-grid">
										<div class="p-field p-col">
											<p:outputLabel for="taxrateorg">Gov Tax Rate</p:outputLabel>
											<p:inputNumber id="taxrateorg" value="#{taxView.selectedPosition.orgRating}" decimalSeparator="." thousandSeparator="," readyonly="true" symbol="%" symbolPosition="s"
												emptyValue="zero" />
										</div>
										<div class="p-field p-col">
											<p:outputLabel for="taxrate">Tax-Rate</p:outputLabel>
											<p:inputNumber id="taxrate" value="#{taxView.selectedPosition.rating}" symbol="%" symbolPosition="s" emptyValue="zero">

												<p:ajax event="valueChange" listener="#{taxView.rateChanged}" update="taxAmount reason" />

											</p:inputNumber>


										</div>
										`
										<div class="p-field p-col">
											<p:outputLabel for="taxAmount">Tax-Amount</p:outputLabel>
											<p:inputNumber id="taxAmount" value="#{taxView.selectedPosition.taxAmount}" decimalSeparator="." thousandSeparator="," />
										</div>
									</div>


									<div class="p-field">
										<p:outputLabel for="reason" rendered="#{taxView.selectedPosition.orgRating != taxView.selectedPosition.rating}">Reason</p:outputLabel>
										<p:selectOneRadio id="reason" rendered="#{taxView.selectedPosition.orgRating != taxView.selectedPosition.rating}" value="#{taxView.selectedPosition.reason}"
											layout="responsive" columns="3" update="comment" valueChangeListener="#{taxView.reasonSelected}">


											<f:selectItem itemLabel="MFN-Clause" itemValue="MFN-Clause" />
											<f:selectItem itemLabel="Different-Client-Position" itemValue="Different-Client-Position" />
											<f:selectItem itemLabel="Other" itemValue="Other" />

											<p:ajax process="@this" update="comment" />


										</p:selectOneRadio>
									</div>

									<div class="p-field">
										<p:outputLabel for="comment">Comment</p:outputLabel>
										<p:inputText id="comment" value="#{taxView.selectedPosition.description}" required="#{taxView.selectedPosition.reason.equals('Other')}">
										</p:inputText>
									</div>


								</p>
							</p:outputPanel>


						</p:outputPanel>
					</p:outputPanel>

					<f:facet name="footer">
						<p:commandButton value="Validate" id="btnAjax" update="manage-product-content" validateClient="true" styleClass="p-mr-2" />
						<p:commandButton value="Save" validateClient="true" icon="pi pi-check" actionListener="#{taxView.saveProduct}" update="manage-product-content :form:taxtabs"
							process="manage-product-content @this" />
						<p:commandButton value="Cancel" icon="pi pi-times" update="manage-product-content" actionListener="#{taxView.cancelTaxEditing}" oncmplete="PF('manageProductDialog').hide()"
							class="ui-button-secondary" />
					</f:facet>
				</p:dialog>






				<p:confirmDialog widgetVar="deleteProductDialog" showEffect="fade" width="300" message="Delete the product?" header="Confirm" severity="warn">
					<p:commandButton value="Yes" icon="pi pi-check" actionListener="#{taxView.deleteProduct}" process="@this" oncomplete="PF('deleteProductDialog').hide()" />
					<p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('deleteProductDialog').hide()" />
				</p:confirmDialog>

				<p:confirmDialog global="true" showEffect="fade" width="300">
					<p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
					<p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
				</p:confirmDialog>
			</div>
		</h:form>



	</h:body>
</html>

